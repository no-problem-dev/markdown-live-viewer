---
references:
  - title: "markserv Repository"
    url: "https://github.com/markserv/markserv"
  - title: "Current Security Audit"
    description: "40 security vulnerabilities identified"
  - title: "Logic Bug Report"
    description: "4 critical logic bugs documented"
---

# Request Specification: markserv Modernization

## 課題認識

### セキュリティ脅威
- **40個のセキュリティ脆弱性**
  - Critical: 2件
  - High: 15件
  - その他: 23件
- 5-6年の更新停止により依存ライブラリが老朽化
- 非推奨APIの継続使用

### 機能的な問題
- **4箇所の重大ロジックバグ**
  - ファイルパス処理の不正確さ
  - Mermaid図表示の不安定性
  - マルチディレクトリサポートの欠落
  - エラーハンドリングの不十分さ

### 保守性の課題
- 古いコード設計パターンの使用
- 非モダンなUIの提供
- 拡張性の低いアーキテクチャ

## 解決アプローチの方向性

### 採用方針
- **0ベースの新規開発**
  - 既存コードの段階的改善ではなく、モダンなアーキテクチャでの完全リファクタ
  - 最新のセキュリティ標準に準拠した設計
  - 拡張可能で保守しやすい実装

### 機能設計

#### 継承するコア機能
1. **コマンドラインからのMarkdownプレビュー**
   - ディレクトリ指定でブラウザで自動開く

2. **Mermaid図のブラウザ確認**
   - 図表描画のネイティブサポート

3. **Markdown内パスのクリック遷移**
   - 相対パスの解決と自動ナビゲーション

4. **ローカルホストでの形式確認**
   - 表形式、文字スタイル等の正確な表示

#### 追加する新機能
1. **複数ディレクトリでの同時起動対応**
   - 異なるポート自動割り当て
   - 複数プロセスの管理

2. **コマンド名の変更**
   - `markserv` → `mdv` への移行
   - より短く、記憶しやすいコマンド名

3. **モダンなUI**
   - 現代的なデザイン言語の採用
   - レスポンシブデザイン対応
   - ダークモード対応の検討

4. **新しいfavicon**
   - ブランドアイデンティティの強化

5. **完全なリファクタとモダナイズ**
   - 最新フレームワークの採用
   - 最新セキュリティベストプラクティスの適用
   - パフォーマンス最適化

#### 削除する機能
- **MD以外のファイルダウンロード機能の廃止**
  - 理由: セキュリティリスク軽減
  - 代替: Raw形式のコード表示機能に変更
  - ユースケース: テキストファイルのプレビュー継続対応

## スコープ定義

### 包含される範囲
- ブラウザベースのMarkdownプレビュー機能
- Mermaid図表示
- ファイルナビゲーション
- 複数インスタンス管理
- セキュリティ強化

### 除外される範囲
- リアルタイム共同編集機能
- クラウドストレージ連携
- ユーザーアカウント管理

## 技術的アプローチ

### セキュリティ重視
- すべての入力値のサニタイズ
- CSP（Content Security Policy）の実装
- CORS設定の厳格化
- 依存ライブラリの定期更新体制の構築

### パフォーマンス
- バンドルサイズの最適化
- キャッシング戦略の実装
- 大規模Markdownファイル対応

### 保守性
- 明確なアーキテクチャ定義
- 包括的なテストカバレッジ
- ドキュメント整備

## 更新履歴

| 日付 | 変更内容 | 作成者 |
|------|---------|--------|
| 2026-01-24 | 初版作成 - プロジェクト要件の定義 | Claude Code |
| 2026-01-24 | コマンド名を `mdv` に統一 | Claude Code |
