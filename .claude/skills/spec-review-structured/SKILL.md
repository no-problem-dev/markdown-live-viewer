---
name: spec-review-structured
description: "仕様書をレビューし、意思決定ポイントと重要度分類を含む構造化レビューレポートを生成する。spec/ディレクトリ内の仕様書を対象に、矛盾・不整合・改善点を特定する際に使用。決定項目（選択肢・メリット/デメリット・決定記入欄付き）と矛盾一覧サマリーの2部構成レポートを出力。仕様書の整合性レビュー、品質保証、実装準備検証に適用。"
---

# 仕様書構造化レビュー

意思決定サポートと重要度分類を備えた、仕様書向けの包括的な構造化レビューレポートを生成する。

## 概要

このスキルは体系的な仕様書レビューをガイドし、以下を実現するアクション可能なレポートを生成:

1. **関心事の分離**: 決定項目（ステークホルダー入力が必要）と問題点（修正が必要）
2. **重要度分類**: 重大/要確認/軽微のカテゴリ分け
3. **意思決定サポート**: 各決定ポイントに対するメリット/デメリット付き選択肢
4. **並列処理**: 複数のレビュー観点を同時実行
5. **正確な参照**: ファイルパスと具体的な場所を含める

## レビュー実行ワークフロー

### 1. レビュー範囲の決定

```
ユーザーがファイル/ディレクトリを指定 → それらをレビュー
指定なし → spec/ディレクトリ全体をレビュー
```

### 2. 並列レビューの実行

以下のレビュー観点でTaskエージェントを同時起動（subagent_type=Explore）:

| 観点 | フォーカス |
|------|-----------|
| **整合性** | ドキュメント間の用語、定義、フロー、データモデルの矛盾をチェック |
| **完全性** | すべての要件が設計仕様と実装計画で対応されているか検証 |
| **実現可能性** | 技術的制約、実装難易度、潜在的ブロッカーを評価 |
| **依存関係** | フェーズ依存関係、優先順位、シーケンスロジックを検証 |

**実装**: 4つのTaskツールコールを並列で含む単一メッセージを送信。

### 3. 結果の収集と統合

TaskOutputを使用して全エージェントから結果を取得。所見を統合し、重複を除去し、重要度別にカテゴリ分け。

### 4. 決定項目の抽出

以下の特徴を持つ問題を特定:
- 複数の有効な解決アプローチがある
- コスト/品質/スコープのトレードオフを伴う
- ビジネス判断が必要
- 技術選択に影響する

各決定項目に対し、明確なメリット/デメリット付きの2〜4つの選択肢を作成。

### 5. 構造化レポートの生成

以下のフォーマットで出力。

## 出力フォーマット

```markdown
# 仕様書レビューレポート

**実施日**: YYYY-MM-DD
**実施者**: [レビュアー名]
**対象**: [files/directories reviewed]

---

## 概要

本レポートは [対象ディレクトリ] 内の仕様書間の矛盾・不整合を調査した結果である。

---

## 意思決定セクション

### 決定項目 D-1: [決定タイトル]

| 項目 | 内容 |
|------|------|
| **重要度** | [重大 / 要確認 / 軽微] |
| **場所** | `[file-path]` |

#### 問題

[問題の詳細な説明]

#### 分析

[問題の背景、影響範囲、技術的考察]

#### 選択肢

| 選択肢 | 内容 | メリット | デメリット |
|--------|------|----------|------------|
| **A** | [選択肢Aの内容] | [メリット] | [デメリット] |
| **B** | [選択肢Bの内容] | [メリット] | [デメリット] |
| **C** | [選択肢Cの内容] | [メリット] | [デメリット] |

#### 補足情報（必要に応じて）

[用語定義案、実装例、参考情報など]

#### 決定記入欄

| 項目 | 記入欄 |
|------|--------|
| **選択** | [ ] A / [ ] B / [ ] C / [ ] その他 |
| **決定者** | |
| **決定日** | |
| **決定理由・意図** | |
| **補足事項** | |

---

### 決定項目 D-2: [決定タイトル]

[上記構造を繰り返す]

---

## 矛盾一覧（サマリー）

| # | 決定項目ID | 重要度 | 矛盾内容 | 関連ファイル | 決定状況 |
|---|-----------|--------|---------|-------------|----------|
| 1 | D-1 | [重大/要確認/軽微] | [矛盾内容の要約] | `[file-path]` | [未決定/完了/対応不要] |
| 2 | D-2 | [重大/要確認/軽微] | [矛盾内容の要約] | `[file-path]` | [未決定/完了/対応不要] |

---

## 決定後のアクション

決定完了後、以下のアクションを実施する。

| 決定項目 | 決定後のアクション | 実施状況 |
|----------|-------------------|----------|
| D-1 | [具体的な修正内容] | ⬜ 未着手 / 🔄 進行中 / ✅ 完了 |
| D-2 | [具体的な修正内容] | ⬜ 未着手 / 🔄 進行中 / ✅ 完了 |

---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | 初版作成 |
```

## 重要度分類ガイドライン

| 重要度 | 判定基準 |
|--------|----------|
| **重大** | 実装をブロックする問題、セキュリティ/法的/コンプライアンスリスク、根本的な設計欠陥 |
| **要確認** | 要件と設計の不整合、重要情報の欠落、重大な矛盾 |
| **軽微** | 曖昧な表現、軽微な矛盾、改善提案、ドキュメントの不備 |

## レビュー品質基準

各指摘には以下を含める:

1. **具体的な場所**: ファイルパスとセクション/行の参照
2. **明確な問題説明**: 客観的な問題の記述
3. **影響分析**: 対処しない場合の結果
4. **具体的な推奨事項**: 修正方法またはアプローチ

各決定項目には以下を含める:

1. **問題のコンテキスト**: なぜ決定が必要か
2. **複数の選択肢**: 2〜4つの実行可能な代替案
3. **バランスの取れた分析**: 各選択肢の正直なメリット/デメリット
4. **決定記入欄**: 選択、決定者、決定日、理由、補足事項

## 禁止事項

- レビュー中に仕様書を修正しない（レビューのみ、編集は別タスク）
- 主観的なスタイル好みを指摘しない（客観的な問題のみ）
- 実装コードを提案しない（仕様レベルの推奨事項のみ）
- 曖昧な批判をしない（具体的なファイル/場所の参照が必要）

## 使用例

```bash
# spec/ディレクトリ全体をレビュー
/spec-review-structured

# 特定ディレクトリをレビュー
/spec-review-structured spec/sdd/02_requirements/

# 特定ファイルをレビュー
/spec-review-structured spec/sdd/03_design_spec/api_design.md

# 特定の観点でレビュー
/spec-review-structured 実装時に混乱を招く曖昧な仕様を見つけて
```

## 高度な使用法

### カスタムレビューフォーカス

ユーザーが特定の指示（例: 「API設計に注目」「データベーススキーマを確認」）を提供した場合、4つのコアアスペクトを維持しながら並列レビュータスクを調整する。

### 大規模仕様セット

非常に大きな仕様セット（50ファイル以上）の場合:
1. まずフェーズ/モジュール別にレビュー
2. モジュール間のサマリー所見を生成
3. 類似の問題を統合してノイズを削減

### 他のスキルとの連携

このスキルは以下と連携:
- `spec01-request` 〜 `spec07-handoff`: それらの出力をレビュー
- 実装計画: 実装準備状況を検証
- 設計検証: 要件に対して設計をクロスチェック
