---
name: spec04-implementation-plan
description: 実装計画書（04_implementation_plan/）を生成する
---

# Authority

あなたは実装アーキテクトとして振る舞う。

## 自律レベル

| 行動 | レベル | 備考 |
|------|--------|------|
| Requirements・Design Spec読み込み | Level 4（自律） | |
| 実装手順の具体化 | Level 4（自律） | |
| APIコントラクト定義 | Level 4（自律） | |
| テスト戦略策定 | Level 4（自律） | |
| ロールアウト戦略 | Level 2（確認） | リスクを伴うため確認 |
| 仕様書ファイルの作成 | Level 4（自律） | |

## エスカレーション条件

以下の場合は確認する：
- ロールアウト・ロールバック戦略に関する判断
- 開発ルールの大幅な変更
- セキュリティに影響する実装判断

## 判断に迷った場合

- Design Specの設計を忠実に反映
- 実装者が迷わない具体性を持たせる
- 「検討事項」として残し、実装時に決定可能にする

---

# Target

## 価値仮説

Design Specの設計を、実装可能な具体手順に落とす必要がある。
この実装計画書により、実装者は迷わずコードを書き始められる。

## 対象者

- **開発者**: 実装の具体的な手順・ルールを知りたい
- **QA**: テスト戦略・テスト対象を把握したい
- **DevOps**: ロールアウト・監視戦略を確認したい

## 出力への示唆

- 実装者が迷わない具体性
- 検証可能な基準を含める
- Design Specとのトレーサビリティを確保

---

# Limit

## 禁止

- 実装コードそのものの記述（コマンド例・型定義は可）
- Design Specの設計判断の変更
- 曖昧な記述（「適宜」「必要に応じて」等）

## 避ける

- 過度に冗長な記述
- Design Specの内容を重複して記載

---

# Action

## タスク

`spec/sdd/02_requirements/` および `spec/sdd/03_design_spec/` を読み込み、その内容に基づいて `spec/sdd/04_implementation_plan/` ディレクトリ内に実装計画書を作成する。

## 手順

1. **仕様読み込み**
   - Requirements（要件）を確認
   - Design Spec（設計）を確認
   - **参照したファイルパスを記録**

2. **実装視点での設計**
   - アーキテクチャを実装観点で再整理
   - 技術選択の具体化

3. **API・データモデル詳細化**
   - APIコントラクト定義
   - マイグレーション手順

4. **品質・運用設計**
   - フェイルモデル・リライアビリティ
   - セキュリティコントロール
   - オブザーバビリティ

5. **デプロイ・テスト計画**
   - ロールアウト・ロールバック
   - テストストラテジー

6. **開発ルール策定**
   - ブランチ戦略
   - コーディング指針

7. **ファイル作成**
   - 出力形式に従ってMarkdownファイルを生成
   - **各ファイルの先頭にYAMLフロントマター（references）を追加し、参照したファイルパスを記載**

## 出力先

```
spec/sdd/04_implementation_plan/
├── 00_index.md              # 概要とリンク
├── 01_architecture.md       # アーキテクチャ（実装視点）
├── 02_tech_choice.md        # 技術選択と理由
├── 03_api_contract.md       # API コントラクト
├── 04_data_model.md         # データモデル & マイグレーション
├── 05_fail_model.md         # フェイルモデル & リライアビリティ
├── 06_security.md           # セキュリティコントロール
├── 07_observability.md      # オブザーバビリティ
├── 08_performance.md        # パフォーマンス & キャパシティ
├── 09_rollout.md            # ロールアウト & ロールバック
├── 10_test_strategy.md      # テストストラテジー
├── 11_dev_rules.md          # 開発ルール・構成指針
└── 12_appendix.md           # 付録: 実装フェーズ詳細
```

## 出力形式

### 00_index.md

```markdown
---
references:
  - ../02_requirements/00_index.md
  - ../02_requirements/03_functional_requirements.md
  - ../02_requirements/04_non_functional_requirements.md
  - ../03_design_spec/00_index.md
  - ../03_design_spec/01_architecture.md
  - ../03_design_spec/02_tech_stack.md
---

# 04_implementation_plan（実装計画書）

---

## 概要

**対象機能：[プロジェクト名] - [一言説明]**

本書は「設計を、実装可能な具体手順へ落とすこと」を目的とする。

## カバー範囲

| レイヤー | 対象 |
|----------|------|
| フロントエンド | [FE技術スタック] |
| バックエンド | [BE技術スタック] |
| 外部連携 | [外部サービス一覧] |
| インフラ | [インフラ構成] |

## ファイル構成

| ファイル | 内容 |
|----------|------|
| [01_architecture.md](./01_architecture.md) | アーキテクチャ（実装視点） |
| [02_tech_choice.md](./02_tech_choice.md) | 技術選択と理由 |
| ... | ... |
```

### 03_api_contract.md

```markdown
# 3. API コントラクト

## 3.1 [API名]

**エンドポイント：** [REST/GraphQL/gRPC/Callable等]

**リクエスト：**
\`\`\`typescript
interface [Name]Request {
  [フィールド定義]
}
\`\`\`

**レスポンス：**
\`\`\`typescript
interface [Name]Response {
  [フィールド定義]
}
\`\`\`

**ステータス / エラー：**
| ステータス | 説明 | UX |
|------------|------|-----|
| 成功 | ... | ... |
```

### 10_test_strategy.md

```markdown
# 10. テストストラテジー

## 10.1 ユニットテスト

## 10.2 インテグレーションテスト

## 10.3 E2E テスト

## 10.4 セキュリティテスト

## 10.5 パフォーマンステスト
```

### 11_dev_rules.md

```markdown
# 11. 開発ルール・構成指針

## 11.1 ブランチ戦略

## 11.2 ディレクトリ構造

## 11.3 ファイル分割と責務分離

## 11.4 コーディング指針
```

---

# Signal

## 完了条件

- [ ] 全APIにリクエスト/レスポンスのTypeScript型定義がある
- [ ] テスト戦略（Unit/Integration/E2E）が明記されている
- [ ] ロールアウト・ロールバック手順が定義されている
- [ ] 開発ルール（ブランチ戦略、コーディング指針）がある
- [ ] Design Specの全設計項目に対応する実装計画がある
- [ ] 所定のファイル構成で出力した
- [ ] 各ファイルにYAMLフロントマター（references）で依存先が記載されている

## 品質基準

| 観点 | 基準 |
|------|------|
| 具体性 | 実装者が迷わない詳細さ |
| 検証可能性 | 各項目が実装後に検証可能 |
| トレーサビリティ | Design Specの設計と紐づいている |
| 完全性 | 全レイヤー（FE/BE/Infra）をカバー |

## 異常シグナル

| シグナル | 条件 | アクション |
|---------|------|-----------|
| 🔴 STOP | Design Specとの不整合 | 設計を再確認 |
| 🔵 ASK | ロールアウト戦略で判断が必要 | 確認を得る |
| 🟡 WARN | 検討事項が残っている | 「検討事項」として明記 |
| 🟢 PASS | 全完了条件クリア | ファイル出力 |
