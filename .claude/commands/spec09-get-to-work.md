---
name: spec09-get-to-work
description: タスク仕様書から未実装タスクを自動的に選択し、ブランチ作成・実装・PRまでを一貫して実行する
---

# Authority

あなたは実装タスク実行管理者として振る舞う。

## 自律レベル

| 行動 | レベル | 備考 |
|------|--------|------|
| 仕様書の読み込み（Serena MCP使用） | Level 4（自律） | セマンティックに把握 |
| 完了タスクの確認 | Level 4（自律） | |
| 未実装タスクの抽出 | Level 4（自律） | |
| 依存関係チェック | Level 4（自律） | |
| コンフリクト分析 | Level 4（自律） | |
| タスク実装 | Level 4（自律） | verificationをすべてクリア |
| ブランチ作成 | Level 4（自律） | 命名規則に従う |
| PR作成 | Level 4（自律） | フォーマットに従う |
| 進捗更新 | Level 4（自律） | |
| 並列実装の自動実行 | Level 4（自律） | コンフリクトなしの場合 |
| `main`への直接PR | Level 0（禁止） | 必ず`develop`へ |
| verification未クリアでのPR | Level 0（禁止） | |

## エスカレーション条件

以下の場合は確認する：
- 依存タスクが未完了
- 実装中に仕様との矛盾を発見
- verificationをクリアできない

## 判断に迷った場合

- 仕様書（spec/sdd/）を再確認
- 依存関係を厳守
- verification全項目クリアを必達

---

# Target

## 価値仮説

タスク仕様書に基づき機械的にタスクを消化する必要がある。
この実行管理により、レビュー可能な単位でPRが提出される。

## 対象者

- **開発チーム**: タスクを機械的に消化し、レビュー可能な単位でPRを受け取りたい
- **レビュアー**: 1PRが1タスクに対応し、レビューしやすい粒度を望む

## 出力への示唆

- 1タスク = 1ブランチ = 1PR
- verification全項目クリア
- 進捗更新を忘れない

---

# Limit

## 禁止

- `main` ブランチへの直接PR
- 依存タスク未完了でのタスク着手
- 影響ファイルが重複するタスクの並列実装
- `verification` 未クリアでのPR作成
- タスク範囲外の「ついでの修正」
- 進捗更新（06_implementation_log/）の記録漏れ
- 並列実装時のブランチ切り替え忘れ

## 避ける

- verificationを満たさない状態での完了報告
- 仕様書の確認なしでの実装開始

---

# Action

## タスク

`spec/sdd/05_tasks/` にある未実装タスクを順番に実装する。

## 手順

### 1. タスク選定フェーズ

1. **仕様書の把握**
   - Serena MCPを用いてセマンティックに仕様書（`@spec/sdd/` 配下）を把握
   - 別タスク実行時の矛盾を回避

2. **進捗確認**
   - `spec/sdd/06_implementation_log/01_completed_tasks.md` と `04_statistics.md` を読み、完了済みタスクを確認
   - 各Phaseファイルから未実装タスクを抽出

3. **依存関係チェック**
   - 選定候補タスクの `deps` フィールドを確認
   - 依存タスクがすべて完了している場合のみ実装可能

4. **コンフリクト分析**
   - 選定候補タスクの `description` から影響ファイルを特定
   - 他の未実装タスクと影響ファイルが重複する場合、コンフリクトリスクありと判定
   - コンフリクトリスクがある場合：先行タスクを優先（Phase順、T番号順）
   - コンフリクトリスクがない場合：並列実装を自動実行

5. **タスク決定**
   - Phase 1 → Phase 2 → ... の順で優先
   - 同一Phase内では T番号の若い順

### 2. 実装フェーズ

1. **ブランチ作成**
   - タスク種別に応じたブランチ種別を決定
   - `develop` から新規ブランチを作成

2. **タスク実装**
   - タスクの `description` に従い実装
   - `spec_refs` の仕様書を確認してから実装
   - `verification` の全項目をクリア

3. **検証**
   - `verification` の各項目を機械的にチェック
   - すべてチェックが通るまで実装を調整

4. **コミット**
   - コミットメッセージ形式：`feat: T[番号] [タスク名]`

### 3. PR作成フェーズ

1. **PR作成**
   - `gh pr create` でPRを作成
   - タイトル：`feat: T[番号] [タスク名]`
   - Base Branch: 必ず `develop`
   - Assignee: `rikuProgramer`

2. **進捗更新**
   - `spec/sdd/06_implementation_log/01_completed_tasks.md` にタスク完了情報を記録
   - `spec/sdd/06_implementation_log/04_statistics.md` の進捗を更新

## ブランチ命名規則

| タスク種別 | ブランチプレフィックス | 例 |
|-----------|---------------------|-----|
| Create/Implement/Add | `feat/` | `feat/t01-initialize-vite-project` |
| Fix | `fix/` | `fix/t42-stripe-webhook-error` |
| ドキュメント作成 | `doc/` | `doc/t85-terms-of-service` |
| Verify/Test | `feat/` | `feat/t90-e2e-test-payment` |

ブランチ名形式：`[prefix]/t[番号]-[kebab-case-task-name]`（30文字以内、英語のみ）

## 出力形式

### タスク開始時

```markdown
## 実装タスク選定

**仕様書の把握**: Serena MCPを用いてセマンティックに仕様書を把握済み

**選定タスク**: T[番号]: [タスク名]
**Phase**: [Phase番号] [Phase名]
**ブランチ名**: [branch-name]

**タスク概要**:
- [description 要約]

**依存関係チェック**:
- [依存タスクの完了状態]

**コンフリクト分析**:
- [他の未実装タスクとのファイル重複チェック結果]
```

### タスク完了時

```markdown
## タスク完了

**完了タスク**: T[番号]: [タスク名]
**ブランチ**: [branch-name]
**PR URL**: [PR URL]

**Verification チェック**:
- [x] [検証項目1]
- [x] [検証項目2]

**次のアクション**:
- CIチェック完了待ち
- レビュー依頼（@rikuProgramer）
- マージ後、次のタスクを実行可能
```

### PR本文フォーマット

```markdown
## Summary
- [タスク概要]

## Body
- [U:追加, M:修正, D:削除]: [ファイル名]
    - [変更内容]

## Verification
- [x] [検証項目1]
- [x] [検証項目2]

## Related
- Task: T[番号]
- Phase: [Phase番号]
```

---

# Signal

## 完了条件

- [ ] 依存タスクがすべて完了している
- [ ] 仕様書（spec_refs）を確認した
- [ ] verification全項目をクリアした
- [ ] 正しいブランチ命名規則に従った
- [ ] PRが`develop`に向けて作成された
- [ ] 進捗更新（06_implementation_log/）を行った

## 品質基準

| 観点 | 基準 |
|------|------|
| 依存関係 | deps記載のタスクがすべて完了済み |
| 仕様準拠 | spec_refsの仕様に従っている |
| 検証 | verification全項目PASS |
| コード品質 | TypeScript厳格モード、ESLint/Prettier準拠 |

## 異常シグナル

| シグナル | 条件 | アクション |
|---------|------|-----------|
| 🔴 STOP | 依存タスク未完了 | 先行タスクの完了を待つ |
| 🔴 STOP | verificationをクリアできない | 実装を見直し、必要に応じて確認 |
| 🔵 ASK | 仕様との矛盾を発見 | 確認を得てから進める |
| 🟡 WARN | コンフリクトリスクあり | 先行タスクを優先 |
| 🟢 PASS | 全完了条件クリア | PR作成・進捗更新 |
