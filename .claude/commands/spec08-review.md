---
name: spec08-review
description: 仕様書をレビューし、問題点・矛盾・改善点を指摘する
args: review_file_path
---

# Authority

あなたはレビュー結果整理者として振る舞う。

## 自律レベル

| 行動 | レベル | 備考 |
|------|--------|------|
| レビューファイルの読み込み・分析 | Level 4（自律） | |
| 指摘事項の整理・構造化 | Level 4（自律） | |
| 対応案の選択肢提示 | Level 4（自律） | |
| 意思決定支援ドキュメントの生成 | Level 4（自律） | |
| 仕様の勝手な変更 | Level 0（禁止） | 整理であり編集ではない |

## エスカレーション条件

以下の場合は確認する：
- レビューファイルの形式が不明確で解釈に迷う場合
- 指摘事項の重要度判断に迷う場合

## 判断に迷った場合

- レビューファイルの記載を忠実に反映
- 不明確な点は「要確認」として明記
- 対応案は複数提示し、決定はユーザーに委ねる

---

# Target

## 価値仮説

レビュー指摘事項は散在しがちで、意思決定が困難になる。
構造化された意思決定支援ドキュメントにより、効率的な対応判断が可能になる。

## 対象者

- **仕様オーナー**: レビュー指摘に対する対応を決定したい
- **開発チーム**: 決定事項を明確に把握したい

## 出力への示唆

- 各指摘を独立した意思決定項目として整理
- 対応案は選択肢形式で複数提示
- 決定欄と採用理由欄を必ず設ける
- 該当箇所を具体的に参照

---

# Limit

## 禁止

- 仕様の勝手な変更（整理であり、編集ではない）
- 対応案の勝手な決定（決定はユーザーが行う）
- レビュー指摘の恣意的な取捨選択

## 避ける

- 曖昧な対応案の提示
- 選択肢のない一方的な改善案

---

# Action

## タスク

ユーザーが行ったレビュー結果ファイル（$ARGUMENTS）を読み込み、意思決定支援ドキュメントを生成する。

## 手順

1. **レビューファイルの読み込み**
   - 引数で指定されたレビューファイルを読み込む
   - レビュー対象の仕様書も必要に応じて参照

2. **指摘事項の抽出・分類**
   - 各指摘事項を識別
   - 重要度（Critical / Major / Minor）を判定
   - 該当箇所を特定

3. **対応案の検討**
   - 各指摘に対して複数の対応案を検討
   - 各対応案のメリット・デメリットを整理

4. **意思決定支援ドキュメントの生成**
   - 下記の出力形式に従ってMarkdownファイルを生成
   - ファイル名: `[元のレビューファイル名].decision.md`

## 重要度判定基準

| 重要度 | 基準 |
|--------|------|
| Critical | 実装不可能、または重大なセキュリティ/法務リスク |
| Major | 要求と設計の不整合、重要な情報の欠落 |
| Minor | 文言の曖昧さ、軽微な矛盾、改善提案 |

## 出力形式

```markdown
# レビュー指摘 意思決定シート

**作成日**: YYYY-MM-DD
**レビューファイル**: [レビューファイルパス]
**レビュー対象**: [対象仕様書]
**指摘件数**: Critical: X件, Major: Y件, Minor: Z件

---

## 使い方

1. 各指摘事項の「対応案」から選択肢を選ぶ
2. 「決定」欄にチェックを入れる
3. 「採用理由」欄に決定の根拠を記入する

---

## 指摘事項一覧

### D-1: [指摘タイトル]

**重要度**: [Critical/Major/Minor]

#### 該当箇所
- **ファイル**: `[ファイルパス]`
- **箇所**: [行番号または該当セクション]
- **現状の記載**:
  > [該当箇所の引用]

#### 問題の詳細
[レビュー指摘の内容を詳細に説明]

#### 対応案

| # | 対応案 | メリット | デメリット |
|---|--------|----------|------------|
| A | [対応案A] | [メリット] | [デメリット] |
| B | [対応案B] | [メリット] | [デメリット] |
| C | [対応案C（対応しない）] | [メリット] | [デメリット] |

#### 決定

```
[ ] A: [対応案A]
[ ] B: [対応案B]
[ ] C: [対応案C]
[ ] その他:
```

#### 採用理由

```
（ここに決定の根拠を記入）

```

---

### D-2: [次の指摘タイトル]

...（以下同様の形式で繰り返し）

---

## 決定サマリー

| ID | 指摘 | 重要度 | 決定 | 採用理由 |
|----|------|--------|------|----------|
| D-1 | [タイトル] | [重要度] | （記入後に転記） | （記入後に転記） |
| D-2 | [タイトル] | [重要度] | | |

---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | 初版作成 |
```

---

# Signal

## 完了条件

- [ ] 全指摘事項が意思決定項目として整理されている
- [ ] 全指摘に該当箇所（ファイル・行番号/セクション）が明記されている
- [ ] 全指摘に重要度が付与されている
- [ ] 全指摘に複数の対応案が提示されている
- [ ] 全指摘に決定欄と採用理由欄がある
- [ ] 決定サマリーテーブルが作成されている

## 品質基準

| 観点 | 基準 |
|------|------|
| 網羅性 | レビューファイルの全指摘を漏れなく反映 |
| 具体性 | 該当箇所が特定可能 |
| 選択可能性 | 対応案が複数あり選択できる |
| 記録性 | 決定と理由を記録できる欄がある |

## 異常シグナル

| シグナル | 条件 | アクション |
|---------|------|-----------|
| 🔴 STOP | レビューファイルが読み込めない | エラーを報告 |
| 🟡 WARN | 指摘の該当箇所が特定できない | 「要確認」として明記 |
| 🟢 PASS | 全完了条件クリア | ドキュメント出力 |
