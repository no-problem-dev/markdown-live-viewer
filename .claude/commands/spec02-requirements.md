---
name: spec02-requirements
description: 要求仕様書（02_requirements/）を生成する
---

# Authority

あなたは要求アナリストとして振る舞う。

## 自律レベル

| 行動 | レベル | 備考 |
|------|--------|------|
| Request仕様書の読み込み・分析 | Level 4（自律） | |
| 機能要件の抽出・構造化 | Level 4（自律） | |
| 非機能要件の定義 | Level 4（自律） | |
| 仕様書ファイルの作成 | Level 4（自律） | |
| ビジネス判断を伴う要件決定 | Level 1（提案） | 選択肢を提示 |
| 実装方法（How）の記述 | Level 0（禁止） | Design Specに委ねる |

## エスカレーション条件

以下の場合は確認する：
- 要件の優先順位が不明確
- 複数の解釈が可能な要件がある
- トレードオフが発生する（性能 vs コスト等）

## 判断に迷った場合

- What（何を満たすべきか）のみ記述
- How（どう実現するか）は書かない
- 不明点は「オープンクエスチョン」に記録

---

# Target

## 価値仮説

Requestの粗い要望を、実装可能な明確な要件に変換する必要がある。
この仕様書により、ステークホルダー間で「何を作るか」の認識が統一される。

## 対象者

- **ビジネス担当者**: 技術用語なしで要件を理解したい
- **開発者**: 実装に必要な要件を明確に把握したい
- **QA**: テスト対象・受け入れ条件を知りたい

## 出力への示唆

- 技術用語を最小限に抑える
- 「ユーザーは〜できる」形式で記述
- 受け入れ条件は検証可能な形で
- 決定事項は追跡可能な形式（D-番号）で記録

---

# Limit

## 禁止

- 実装詳細（How）の記述
  - ❌「Firebase Authenticationで認証する」
  - ✅「メールアドレスまたはGoogleアカウントでログインできる」
- データベーススキーマ、API設計の記載
- 特定ライブラリ・フレームワーク名の言及（外部サービス名は可）
- 曖昧な表現（「速い」「多い」→ 数値化する）

## 避ける

- 過度に詳細な記述（Design Specに委ねる）
- 技術者しか理解できない用語
- 検証不可能な要件

---

# Action

## タスク

`spec/sdd/01_request/` を読み込み、その内容に基づいて `spec/sdd/02_requirements/` ディレクトリ内に要求仕様書を作成する。

## 手順

1. **Request読み込み**
   - `spec/sdd/01_request/01_request.md` を読み込み
   - 課題認識・解決アプローチを把握
   - **参照したファイルパスを記録**

2. **要件抽出**
   - 機能要件を洗い出し
   - 非機能要件（性能、可用性、セキュリティ等）を定義
   - ユーザーストーリーを作成
   - ドメイン固有の仕様がある場合は追加ファイルとして分離

3. **責務分離チェック**
   - What/How判断基準に照らして確認
   - Howが混入していれば削除または移動

4. **決定事項の記録**
   - 重要な決定には `D-番号` を付与（例: D-1, D-2, ...）
   - 決定根拠を必ず記載
   - 決定日を明記

5. **ファイル作成**
   - 出力形式に従ってMarkdownファイルを生成
   - **各ファイルの先頭にYAMLフロントマター（references）を追加し、参照したファイルパスを記載**
   - **各ファイルの末尾に更新履歴セクションを追加**

## What/How 判断基準

| 質問 | Yes → Requirements | No → Design Spec |
|------|-------------------|------------------|
| ビジネス担当者が理解できるか？ | ✅ | |
| 技術を変えても内容は変わらないか？ | ✅ | |
| 「〜ができること」という形式か？ | ✅ | |
| 「〜を使って実装」という形式か？ | | ✅ |
| ライブラリ名・ツール名が含まれるか？ | | ✅ |

## 責務分離表

| このディレクトリに書くこと（What） | 03_design_spec に書くこと（How） |
|-----------------------------------|----------------------------------|
| 機能要件（「ユーザーは〜できる」） | データベーススキーマ |
| 非機能要件（目標値のみ） | API設計 |
| ユーザーストーリー | 技術選定の詳細 |
| ビジネスルール | 実装方式 |
| 入出力仕様 | 処理フロー詳細 |
| 受け入れ条件 | UI設計詳細 |
| 制約・前提 | セキュリティ実装 |

## 出力先

### 基本ファイル（必須）

```
spec/sdd/02_requirements/
├── 00_index.md                      # 概要とリンク、責務分離表
├── 01_feature_overview.md           # 機能概要（What/Why/Intent）
├── 02_user_stories.md               # ユーザーストーリー
├── 03_functional_requirements.md    # 機能要件
├── 04_non_functional_requirements.md # 非機能要件（NFR）
├── 05_io_spec.md                    # I/O仕様
├── 06_constraints.md                # 制約・前提・外部依存
└── 07_open_questions.md             # オープンクエスチョン
```

### 追加ファイル（必要に応じて）

| 種類 | ファイル名例 | 作成条件 |
|------|-------------|----------|
| ドメイン固有仕様 | `08_[domain]_overview.md` | プロダクト固有の概念体系がある場合 |
| ビジネス仕様 | `XX_revenue_model.md` | 収益モデルの定義が必要な場合 |
| ロードマップ | `XX_roadmap.md` | フェーズ分けや優先順位の定義が必要な場合 |
| 分析仕様 | `XX_analytics_events.md` | 計測イベントの定義が必要な場合 |
| レビュー結果 | `99_review_report.md` | 仕様レビュー後 |

**番号付け規則**:
- 00-07: 基本ファイル（必須）
- 08-89: 追加仕様ファイル（プロジェクト固有）
- 90-98: 予備
- 99: レビュー・付録

---

## 出力形式

### 00_index.md

```markdown
# 02_requirements（要求仕様書）

---

## 概要

このディレクトリには要求仕様書の各セクションが含まれる。
**「何を満たすべきか（What）」を定義する段階。**

「どう実現するか（How）」は [03_design_spec](../03_design_spec/00_index.md) を参照。

### Requirements vs Design Spec の責務分離

| このディレクトリに書くこと（What） | 03_design_spec に書くこと（How） |
|-----------------------------------|----------------------------------|
| 機能要件（「ユーザーは〜できる」） | データベーススキーマ |
| 非機能要件（目標値のみ） | API設計 |
| ユーザーストーリー | 技術選定の詳細 |
| ビジネスルール | 実装方式 |
| 入出力仕様 | 処理フロー詳細 |
| 受け入れ条件 | UI設計詳細 |
| 制約・前提 | セキュリティ実装 |

## ファイル構成

| ファイル | 内容 |
|----------|------|
| [01_feature_overview.md](./01_feature_overview.md) | 機能概要（What/Why/Intent） |
| [02_user_stories.md](./02_user_stories.md) | ユーザーストーリー |
| [03_functional_requirements.md](./03_functional_requirements.md) | 機能要件 |
| [04_non_functional_requirements.md](./04_non_functional_requirements.md) | 非機能要件（NFR） |
| [05_io_spec.md](./05_io_spec.md) | I/O仕様 |
| [06_constraints.md](./06_constraints.md) | 制約・前提・外部依存 |
| [07_open_questions.md](./07_open_questions.md) | オープンクエスチョン |

## 次の段階

→ [03_design_spec](../03_design_spec/00_index.md)（設計仕様書）
```

### 01_feature_overview.md

```markdown
# 1. 機能概要（Feature Overview）

## 1.1 What（何をする機能か）

[プロダクトが提供する機能を1-2文で簡潔に説明]

---

## 1.2 Why（なぜ必要か）

### ビジネス価値

- **[価値1の見出し]**: [説明]
- **[価値2の見出し]**: [説明]

### ユーザー価値

**コアバリュー**: 「[ユーザーにとっての核心的な価値を1文で]」

- **[価値1の見出し]**: [説明]
- **[価値2の見出し]**: [説明]

---

## 1.3 Intent（最優先の意図）

**「[設計判断時の最優先制約条件を1文で明記]」**

※ 設計判断時の最優先制約条件として、[補足説明]

---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | 初版作成 |
```

### 02_user_stories.md

```markdown
# 2. ユーザーストーリー（User Story）

## US1: [ユーザータイプ/ペルソナ名]

```
As a [具体的なペルソナ/役割]
I want to [達成したいこと]
So that [得られる価値・便益]
```

## US2: [ユーザータイプ/ペルソナ名]

```
As a [具体的なペルソナ/役割]
I want to [達成したいこと]
So that [得られる価値・便益]
```

[必要に応じてUS3, US4...を追加]

---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | 初版作成 |
```

### 03_functional_requirements.md

```markdown
# 3. 機能要件（Functional Requirements）

## 要件1: [機能名]

### 説明（Description）

[機能の概要を1-2文で説明]
※「何ができるか」を記述。「どう実装するか」は記述しない。

### 受け入れ条件（Acceptance Criteria）

| シナリオ | 条件 | 期待結果 |
|----------|------|----------|
| **正常系** | [正常な入力/操作] | [期待される出力/結果] |
| **正常系** | [別の正常パターン] | [期待される出力/結果] |
| **異常系** | [異常な入力/状態] | [エラーハンドリング/メッセージ] |
| **異常系** | [別の異常パターン] | [エラーハンドリング/メッセージ] |
| **境界値** | [境界条件] | [境界での動作] |

### 詳細条件

- [検証可能な条件1]
- [検証可能な条件2]
- [検証可能な条件3]
- **[決定事項の見出し]**（D-X決定事項）
  - [決定内容の詳細]

### [サブ機能/特殊ケース]（D-X決定事項）

**決定**: [何を決定したか]

**決定根拠**: [なぜその決定をしたか]

**仕様**:
- [具体的な仕様1]
- [具体的な仕様2]

---

## 要件2: [機能名]

[同様の構造で記載]

---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | 初版作成 |
```

### 04_non_functional_requirements.md

```markdown
# 4. 非機能要件（NFR: Non-Functional Requirements）

## 4.1 性能要件

| 項目 | 目標値 | 備考 |
|------|--------|------|
| [計測項目1] | [数値目標] | [測定条件や補足] |
| [計測項目2] | [数値目標] | [測定条件や補足] |

※ 目標値のみ記載。達成方法（キャッシュ方式等）は 03_design_spec/ に記載。

---

## 4.2 可用性

| 項目 | 要件 |
|------|------|
| 稼働率 | [目標値（例: 99%以上）] |
| ネットワーク | [オンライン/オフライン要件] |

### [特記事項]（必要に応じて）

- [可用性に関する補足説明]

**決定根拠**: [決定の理由]

---

## 4.3 セキュリティ

| 項目 | 要件 |
|------|------|
| 認証 | [必要な認証方式（メール/Google等）] |
| 認証なしアクセス | [認証なしで可能な操作範囲] |
| データ保護 | [保護すべきデータと保護レベル] |

---

## 4.4 観測性（Observability）

| 項目 | 要件 |
|------|------|
| ログ | [収集すべき情報] |
| メトリクス | [計測すべき指標] |
| トレース | [トレーサビリティ要件] |

---

## 4.5 スコープ定義

### 含むもの（In Scope）

- [スコープ内の項目1]
- [スコープ内の項目2]

### 含まないもの（Out of Scope）

- [スコープ外の項目1]
- [スコープ外の項目2]

### 将来計画（参照用）

**注**: 詳細なロードマップがある場合は該当ファイルを参照。

| フェーズ | 主要内容 |
|----------|----------|
| [フェーズ1] | [概要] |
| [フェーズ2] | [概要] |

---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | 初版作成 |
```

### 05_io_spec.md

```markdown
# 5. I/O仕様

## 5.1 種別

[UI / API / CLI / バッチ など]

## 5.2 [操作/エンドポイント名]

**Input（入力）**:
```
[入力の具体例]
```

**Output（出力）**:
```
[正常時の出力例]
```

**Error（異常時）**:
```
[エラーメッセージの例]
```

## 5.3 [別の操作/エンドポイント名]

[同様の構造で記載]

---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | 初版作成 |
```

### 06_constraints.md

```markdown
# 6. 制約・前提・外部依存

## 6.1 プロジェクト制約

| 項目 | 内容 |
|------|------|
| 開発体制 | [人数/体制] |
| 予算 | [予算制約] |
| スケジュール | [期限・マイルストーン] |

## 6.2 前提条件

| 項目 | 前提 |
|------|------|
| ユーザー環境 | [必要な環境] |
| ネットワーク | [接続要件] |
| [その他] | [前提条件] |

## 6.3 外部サービス依存

| サービス | 用途 | 制約 | 超過時対応 |
|----------|------|------|------------|
| [サービス名] | [何のために使うか] | [無料枠制限等] | [対応方針] |

※ 接続方式・API仕様の詳細は 03_design_spec/ に記載。

## 6.4 技術制約

| 項目 | 制約 |
|------|------|
| 対応ブラウザ | [対象ブラウザ] |
| 対応デバイス | [対象デバイス] |
| ネットワーク | [オンライン/オフライン要件] |

※ フレームワーク・ライブラリ選定は 03_design_spec/ に記載。

## 6.5 パフォーマンス制約

| 項目 | 目標値 |
|------|--------|
| [計測項目] | [数値] |

## 6.6 セキュリティ制約

| 項目 | 要件 |
|------|------|
| 通信 | [暗号化要件] |
| 認証情報 | [管理方針] |
| データ暗号化 | [暗号化要件] |

## 6.7 データ制約

| 項目 | 方針 |
|------|------|
| データ保持期間 | [保持ポリシー] |
| バックアップ | [バックアップ方針] |
| 個人情報の範囲 | [取得する個人情報] |

## 6.8 法的・規制制約

| 法規制 | 対応要件 |
|--------|----------|
| [該当法規制] | [対応内容] |

**必須ドキュメント**:
- [必要な法的文書のリスト]

## 6.9 運用制約

| 項目 | 方針 |
|------|------|
| 保守体制 | [対応体制] |
| 障害対応 | [SLA/対応時間] |
| 問い合わせ対応 | [対応チャネル/目標時間] |

## 6.10 スケーラビリティ制約

| フェーズ | 想定規模 | 対応方針 |
|----------|----------|----------|
| [フェーズ名] | [規模] | [方針] |

---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | 初版作成 |
```

### 07_open_questions.md

```markdown
# 7. オープンクエスチョン（Open Questions）

## 未決定事項

| No | 質問 | ステータス | 備考 |
|----|------|------------|------|
| Q1 | [未決定事項] | 未決定 | |
| Q2 | [未決定事項] | 検討中 | [進捗] |

---

## 決定済み事項

| ID | 質問 | 決定内容 | 決定日 | 決定根拠 |
|----|------|----------|--------|----------|
| D-1 | [元の質問] | [決定内容] | YYYY-MM-DD | [理由] |
| D-2 | [元の質問] | [決定内容] | YYYY-MM-DD | [理由] |

---

## 制約・前提（サマリ）

| 項目 | 内容 |
|------|------|
| [項目] | [内容] |

---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | 初版作成 |
```

---

## 決定事項の記録規則

### D-番号の付与

重要な設計判断には一意の識別子を付与する。

**形式**: `D-[番号]`（例: D-1, D-2, D-3, ...）

**記録内容**:
```markdown
### [決定事項のタイトル]（D-X決定事項）

**決定**: [何を決定したか - 1文で]

**決定根拠**: [なぜその決定をしたか - 理由と考慮した代替案]

**仕様**:
- [決定に基づく具体的な仕様1]
- [決定に基づく具体的な仕様2]
```

**参照方法**: 他のファイルから参照する際は `（D-X決定事項）` の形式で言及。

---

## 更新履歴の書き方

各ファイルの末尾に以下の形式で更新履歴を記載する。

```markdown
---

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| YYYY-MM-DD | [変更内容の概要] |
| YYYY-MM-DD | 初版作成 |
```

**注意点**:
- 最新の更新を上に記載
- 変更内容は具体的に（「D-X決定に基づき○○を修正」など）

---

# Signal

## 完了条件

- [ ] 全機能要件に受け入れ条件（正常系/異常系/境界値）がある
- [ ] 非機能要件に数値目標が明記されている
- [ ] 実装詳細（How）が混入していない
- [ ] ユーザーストーリーがAs a/I want to/So that形式
- [ ] 所定のファイル構成で出力した
- [ ] 各ファイルにYAMLフロントマター（references）で依存先が記載されている
- [ ] 各ファイルに更新履歴セクションがある
- [ ] 決定事項にD-番号と決定根拠が記載されている
- [ ] 00_index.mdに責務分離表が含まれている

## 品質基準

| 観点 | 基準 |
|------|------|
| 責務分離 | What/How判断基準をすべてクリア |
| 検証可能性 | 全要件がYes/Noで判定可能 |
| 完全性 | Requestの課題に対応する要件がある |
| 明確性 | 曖昧な表現（速い、多い等）がない |
| 追跡可能性 | 決定事項にD-番号と根拠が記載されている |
| 一貫性 | ファイル間で矛盾がない |

## 異常シグナル

| シグナル | 条件 | アクション |
|---------|------|-----------|
| 🔴 STOP | HowがWhatに混入 | 該当箇所を削除または03_design_specへ移動 |
| 🔵 ASK | 要件の優先順位が不明 | ユーザーに確認 |
| 🔵 ASK | トレードオフが発生 | 選択肢を提示 |
| 🟡 WARN | 受け入れ条件が正常系のみ | 異常系・境界値を追加 |
| 🟡 WARN | 決定根拠が不明確 | 理由を明記 |
| 🟢 PASS | 全完了条件クリア | ファイル出力 |
