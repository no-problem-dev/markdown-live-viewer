---
title: "要件仕様書 (Requirements Specification)"
version: "1.0.0"
references:
  - document: "01_request.md"
    relation: "基盤となるリクエスト"
---

# 要件仕様書

## 機能要件 (Functional Requirements)

### コア機能（継承）
既存のmarkservから継承される基本機能

1. **CLIコマンド実行**
   - CLIコマンド `mdv` でディレクトリを指定
   - Markdownプレビューサーバーを起動
   - ローカルブラウザで自動的にプレビューを表示
   - **AC**: `mdv <dir>` 実行後、指定ディレクトリがブラウザで開くこと

2. **Mermaid図のレンダリング**
   - Markdown内に埋め込まれたMermaid記法をレンダリング
   - フローチャート、シーケンス図、ダイアグラムなどに対応
   - **AC**: ` ```mermaid` ブロックが図として正しくレンダリングされること

3. **ナビゲーション機能**
   - Markdown内のリンクをクリックで対象ファイルへ遷移
   - ファイルシステム内の相対パス参照をサポート
   - ツールバーでの履歴管理（戻る/進む）
   - **AC**: 相対パスリンクのクリックで対象ファイルが表示されること

4. **Markdownレンダリング**
   - テーブル、コードブロック等の適切なレンダリング
   - シンタックスハイライト対応
   - **AC**: GFMテーブル、コードブロックが正しく表示されること

5. **MathJax 数式レンダリング**
   - LaTeX記法（`$E=mc^2$`、`$$...$$`）をMathJaxでレンダリング
   - 技術文書での数式表示をサポート
   - **AC**: インライン数式 `$...$` とブロック数式 `$$...$$` が正しく表示されること

6. **README自動検索（サブコマンド）**
   - `mdv readme` コマンドで最も近いREADME.mdを自動検索・表示
   - **AC**: `mdv readme` 実行時、カレントディレクトリまたは親ディレクトリのREADME.mdが開くこと

### 新機能 (New Features)

1. **複数ディレクトリでの同時起動**
   - 異なるディレクトリで複数インスタンスを同時起動可能
   - 各インスタンスは異なるポートで動作
   - ポート番号の自動割り当て（または明示的指定->設定ファイルをいじって明示的に指定してもらう設計を想定．これはターゲットがエンジニアを想定しているためコードリーディングができることを想定．）
   - **AC**: 2つの異なるディレクトリで `mdv` を同時起動でき、それぞれ異なるポートで動作すること

2. **モダンなUIデザイン**
   - レスポンシブデザイン対応
   - 改善されたナビゲーションUI
   - ファイルツリービュー表示
   - **AC**: サイドバーにファイルツリーが表示され、ファイルをクリックで遷移できること

3. **新しいfavicon**
   - プロジェクト固有のfaviconを設定
   - ブラウザタブで視認性向上
   - **AC**: ブラウザタブにカスタムfaviconが表示されること

4. **Markdownファイル以外のサポート**
   - MD以外のファイル（.js, .json, .html等）はrawコード表示
   - ダウンロード形式ではなくブラウザ内表示
   - プレーンテキストファイル対応
   - **AC**: .js, .json ファイルがシンタックスハイライト付きで表示されること

## 非機能要件 (Non-Functional Requirements)

### 互換性
1. **Node.js バージョン**
   - Node.js 18.0.0以上対応
   - Node.js 20.x, 22.xで動作確認済み

2. **モジュール形式**
   - 開発言語はtype scriptを採用
     - jsより型安全であるため

### セキュリティ
1. **パストラバーサル攻撃防止**
   - リクエストパスの正規化と検証
   - 指定ディレクトリ外へのアクセス防止
   - 入力値の厳密なバリデーション

2. **その他セキュリティ対策**
   - XSS（クロスサイトスクリプティング）対策
   - CSRF（クロスサイトリクエストフォージェリ）対策検討
   - セキュアなヘッダー設定

### パフォーマンス
1. **非同期処理**
   - 非同期I/Oの活用（fs/promises等）
   - async/await統一による処理の最適化
   - ファイル読み込みのキャッシング機構

2. **その他パフォーマンス考慮**
   - レスポンス時間: 200ms以内（キャッシュ時）
   - 大容量ファイル対応（ストリーミング等）
   - メモリ使用量の最適化

### テスト
1. **テストカバレッジ: 80%以上**
   - ユニットテスト
   - 統合テスト

2. **テストフレームワーク**
   - カバレッジ測定ツール統合

### 保守性
1. **コード品質**
   - ESLint による静的解析
   - Prettier による自動フォーマット
   - ドキュメント整備

2. **ロギング**
   - 調査可能なログレベル管理
   - デバッグモード対応

## 制約・前提 (Constraints & Assumptions)

### 技術的制約
1. **言語**
   - TypeScript を使用する

2. **フレームワーク・ライブラリ**
   - 既存パッケージ: marked, mermaid等は継続使用
   - 新規依存性は最小限に

3. **デプロイ・配布**
   - npmパッケージとして公開
   - スコープ付きパッケージ名検討: `@markdown-viewer`

### 後方互換性
1. **既存markservとの関係**
   - 既存のmarkservとの後方互換性は考慮しない
   - 機能の継承はするものの関連性はないものとして開発・配布をする

### ターゲットユーザー
1. **開発者向けツール**
   - Markdown ドキュメント作成者
   - オープンソース プロジェクト管理者
   - 技術ドキュメント作成者

### 環境前提
1. **ローカル開発環境**
   - ローカルホストでの起動を前提
   - セキュリティ上、外部ネットワーク公開は推奨されない

## 更新履歴 (Changelog)

### v1.0.0 (2026-01-24)
- 初版作成
- コア機能、新機能の定義
- 非機能要件の整理
- 制約・前提の記載

### v1.0.1 (2026-01-24)
- CLIコマンド名を `mdv` に統一
- テストフレームワークを Jest に決定

### v1.1.0 (2026-01-25)
- MathJax数式レンダリング機能を追加（DEC-001）
- `mdv readme` サブコマンドを追加（DEC-004）
- 各機能要件にAC（受け入れ条件）を追加
- レビュー（90_review）での意思決定を反映
