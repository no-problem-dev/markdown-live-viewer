# 仕様書レビュー

**レビュー日**: 2026-01-25
**対象**: `spec/` 内の新仕様書 vs `archived-markserv/spec/` 既存markserv仕様書

---

## 1. レビュー概要

### 1.1 レビュー目的
- 新仕様書が既存markservの機能を上位互換として継承しているか検証
- 仕様書の品質・完成度を評価
- 意思決定が必要な項目を特定

### 1.2 基本認識
- 作成するのは markserv のバージョンアップではなく、機能を継承した**まったくの別ライブラリ**
- プロダクト名: **markdown-viewer**
- CLIコマンド名: **mdv**
- 開発言語: **TypeScript**（型安全性のため）

---

## 2. 機能カバレッジ分析

### 2.1 継承確認済み機能

| 既存機能 | 新仕様書での対応 | 参照箇所 |
|---------|----------------|---------|
| Markdown→HTML変換（GFM） | ✓ | 02_requirements |
| ディレクトリインデックス表示 | ✓ ファイルツリービューとして強化 | 02_requirements |
| LiveReload | ✓ | 03_design_spec/06_live_reload.md |
| Mermaidダイアグラム | ✓ | 02_requirements |
| シンタックスハイライト | ✓ | 02_requirements, 03_components |
| 相対パスリンク遷移 | ✓ | 02_requirements |

### 2.2 未定義機能（意思決定必要）

| 既存機能 | 状況 | 決定ID |
|---------|------|--------|
| MathJax 数式レンダリング | 言及なし | DEC-001 |
| 絵文字変換 (:smile: → 😄) | 言及なし | DEC-002 |
| 目次（[[toc]]）自動生成 | 言及なし | DEC-003 |
| `readme` コマンド | 言及なし | DEC-004 |
| implant テンプレートシステム | 言及なし | DEC-005 |
| LESS→CSS コンパイル | 言及なし | DEC-006 |

---

## 3. 意思決定項目

### DEC-001: MathJax 数式レンダリング

**現状**: 既存markservでは `$E=mc^2$` のようなLaTeX記法をMathJaxでレンダリング可能

| 選択肢 | メリット | デメリット |
|-------|---------|-----------|
| A. 継承する | 技術文書での需要あり、上位互換維持 | CDN依存、バンドルサイズ増加 |
| B. 削除する | 実装シンプル化、依存減少 | 数式を含むドキュメントが表示不可 |
| C. プラグイン化 | コア軽量化、必要時のみ有効化 | 設計複雑化、初期リリース遅延 |

**推奨**: A（継承する）
**理由**: 技術ドキュメントでの数式需要は高く、CDN読み込みのためバンドルサイズへの影響は軽微

**決定**:
[x] A. 継承する
[ ] B. 削除する
[ ] C. プラグイン化（将来対応）

継承する場合は完全な新機能開発ではないため工数は大きく増えないと判断した

---

### DEC-002: 絵文字変換

**現状**: 既存markservでは `:smile:` → 😄 のような変換をサポート

| 選択肢 | メリット | デメリット |
|-------|---------|-----------|
| A. 継承する | GitHub互換性維持 | 依存パッケージ追加 |
| B. 削除する | 実装シンプル化 | GFM完全互換ではなくなる |

**推奨**: A（継承する）
**理由**: GFM互換を謳う以上、絵文字は標準機能

**決定**:
[ ] A. 継承する
[x] B. 削除する

一般的なmd資料はこうした絵文字がないためこの機能は削除する

---

### DEC-003: 目次（TOC）自動生成

**現状**: 既存markservでは `[[toc]]` で見出しから目次を自動生成

| 選択肢 | メリット | デメリット |
|-------|---------|-----------|
| A. 継承する | 長文ドキュメントで有用 | markdown-itプラグイン依存 |
| B. 削除する | 実装シンプル化 | 長文ナビゲーション困難 |
| C. UIで常時表示 | 明示的な[[toc]]不要、UX向上 | UI設計変更必要 |

**推奨**: C（UIで常時表示）
**理由**: モダンUIを謳うなら、サイドバーにTOCを常時表示する方がUX向上

**決定**:
[ ] A. 継承する（[[toc]]記法）
[x] B. 削除する
[ ] C. UIで常時表示（サイドバー）

ディレクトリ構造をUI上に作成し、そこからファイルにジャンプできるようにするためこの機能は不要と判断した

---

### DEC-004: `readme` コマンド

**現状**: 既存markservでは `readme` コマンドで最も近いREADME.mdを自動検索・表示

| 選択肢 | メリット | デメリット |
|-------|---------|-----------|
| A. 継承する（別コマンド） | 利便性維持 | 2つのCLIコマンド管理 |
| B. `mdv` のサブコマンド化 | コマンド体系統一 | `mdv readme` の入力が長い |
| C. 削除する | 実装シンプル化 | 便利機能の喪失 |
| D. `mdv` のデフォルト動作に統合 | 引数なし時にREADME.md自動検索 | 現行動作との互換性 |

**推奨**: D（デフォルト動作に統合）
**理由**: `mdv` をディレクトリで実行した際、README.mdがあれば自動表示する動作が直感的

**決定**:
[ ] A. 継承する（`readme` コマンド）
[x] B. サブコマンド化（`mdv readme`）
[ ] C. 削除する
[ ] D. デフォルト動作に統合

---

### DEC-005: implant テンプレートシステム

**現状**: 既存markservでは `{file:...}`, `{markdown:...}`, `{html:...}`, `{less:...}` でファイル挿入・変換

| 選択肢 | メリット | デメリット |
|-------|---------|-----------|
| A. 継承する | 高度なテンプレート機能 | 実装複雑、セキュリティリスク |
| B. 削除する | 実装シンプル化、セキュリティ向上 | 高度な使い方ができなくなる |
| C. 簡易版のみ実装 | バランス | 中途半端な機能 |

**推奨**: B（削除する）
**理由**:
- セキュリティリスク（任意ファイル読み込み）
- 使用頻度が低い高度機能
- Markdownプレビューの本質から外れる

**決定**:
[ ] A. 継承する
[x] B. 削除する
[ ] C. 簡易版のみ実装

mdプレビューには不要な機能

---

### DEC-006: LESS→CSS コンパイル

**現状**: 既存markservでは `{less:...}` でLESSファイルをCSSにコンパイル

| 選択肢 | メリット | デメリット |
|-------|---------|-----------|
| A. 継承する | スタイルカスタマイズ柔軟 | LESS依存、実装複雑 |
| B. 削除する | 実装シンプル化 | カスタムスタイル機能喪失 |

**推奨**: B（削除する）
**理由**: implantシステムに依存、Markdownプレビューの本質から外れる

**決定**:
[ ] A. 継承する
[x] B. 削除する

mdプレビューの本質から外れており不要な機能と判断

---

## 4. 仕様書の問題点

### 4.1 設計上の矛盾

| 問題 | 詳細 | 深刻度 | 対応 |
|-----|------|--------|------|
| TypeScript vs JavaScript | 02_requirementsでTypeScript明記だが、03_componentsのコード・ディレクトリ構造が`.js` | 高 | 03_componentsを`.ts`に修正 |
| プロダクト名の混在 | `markserv`, `mdv`, `Mark Server` が混在 | 高 | `markdown-viewer`に統一 |

### 4.2 未定義項目

| 項目 | 詳細 | 深刻度 | 対応 |
|-----|------|--------|------|
| AC条件 | 各機能要件に対する受け入れ条件が未定義 | 高 | 02_requirementsにAC追加 |
| TDD統合 | タスク定義にテストファースト未組込 | 高 | 04_tasksを修正 |
| プロバイダー設計 | DI/サービスプロバイダー設計なし | 中 | 03_design_specに追加 |
| .gitignore | 定義なし | 低 | プロジェクト初期化時に作成 |

---

## 5. 推奨アクションリスト

### 5.1 優先度: 高（仕様書修正必須）

| # | アクション | 対象ファイル |
|---|-----------|-------------|
| 1 | プロダクト名を `markdown-viewer` に統一 | 全仕様書 |
| 2 | 03_components.md のディレクトリ構造・コード例を `.ts` に修正 | 03_design_spec/03_components.md |
| 3 | 各機能要件にAC条件を追加 | 02_requirements/index.md |
| 4 | DEC-001〜006の決定を反映 | 02_requirements/index.md |

### 5.2 優先度: 中（品質向上）

| # | アクション | 対象ファイル |
|---|-----------|-------------|
| 5 | タスク定義にTDDサイクルを組込 | 04_tasks/*.md |
| 6 | プロバイダー/DI設計を追加 | 03_design_spec/ (新規ファイル) |

### 5.3 優先度: 低（実装時対応可）

| # | アクション | 対象ファイル |
|---|-----------|-------------|
| 7 | .gitignore テンプレート作成 | プロジェクトルート |

---

## 6. 結論

### 6.1 上位互換性の評価

**判定: 条件付き上位互換**

- コア機能（Markdown表示、Mermaid、LiveReload）は継承されている
- 一部の高度機能（MathJax、絵文字、TOC、implant）は未定義で意思決定が必要
- 新機能（複数ディレクトリ、モダンUI、ファイルツリー）により機能拡張されている

### 6.2 仕様書品質の評価

**判定: 修正必要**

- 基本構造は整っているが、TypeScript/JavaScript の矛盾解消が必須
- AC条件の追加により検証可能な仕様にする必要あり
- 意思決定項目（DEC-001〜006）の決定後、仕様書への反映が必要

---

## 更新履歴

| 日付 | 変更内容 | 作成者 |
|------|---------|--------|
| 2026-01-25 | 初版（問題点リスト） | - |
| 2026-01-25 | 構造化レビュー、意思決定項目追加 | Claude Code |
| 2026-01-25 | 意思決定(DEC-001〜006)を各仕様書に反映、プロダクト名をmarkdown-viewerに統一、.jsを.tsに修正 | Claude Code |
| 2026-01-25 | 04_tasks にタスク追加: 1.6 `mdv readme`、2.7 MathJax。CSP設定更新（font-src追加）。03_design_spec にMathJax・readme設計追加 | Claude Code |
